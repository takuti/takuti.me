<!DOCTYPE html>
<html>
  <head>
    <meta name="google-site-verification" content="LuC5G9RgHqMbCs-j6JqTMh9NjBFDlnmtliW1JOyotbQ" />
    <meta charset="utf-8">
    <meta name=keywords content="機械学習, オライリー, 実践機械学習, レコメンデーション, 協調フィルタリング, " />
    <meta name=description content="無料で公開されている電子書籍『実践 機械学習』の原著のほうを読みました。" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
    <title>【実践 機械学習】レコメンデーションをシンプルに、賢く実現するための3か条 | takuti.me</title>

    <link href='http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://localhost:1313/style/style.css">
    <link href="http://localhost:1313/google-code-prettify/tomorrow-night-eighties.css" rel="stylesheet">

    <link rel="shortcut icon" href="http://localhost:1313/images/favicon.ico" />
    <link rel="alternate" type="application/atom+xml" title="takuti.me" href="http://localhost:1313/feed/index.xml" />

    <script src="//twemoji.maxcdn.com/twemoji.min.js"></script>
    <script>
      var emoji = function(unicode) { 
        document.write(" <img src='http://twemoji.maxcdn.com/36x36/" + unicode + ".png' class='emoji' alt='emoji' /> "); 
      };
    </script>
  </head>
  <body>
    <header>
    <a href="http://localhost:1313/"><img src="http://localhost:1313/images/s9.jpg" /></a>
    </header>

    <div id="container">
<article>
  <p class="meta clearfix">
    2014-09-01
  </p>
  <h2>【実践 機械学習】レコメンデーションをシンプルに、賢く実現するための3か条</h2>

  <div class="post">
    

<p>Amazonの商品レコメンドやTwitterのオススメユーザ表示のような、アイテムを推薦してくれるシステムは便利だ。僕らユーザは新たな興味深い商品を簡単に発見できるし、システムを提供する側は場合によっては推薦そのものが効果的なマーケティングになる。</p>

<p>このような推薦システムは、機械学習を応用したアプリケーションの1つ。</p>

<p>機械学習と聞くと、それだけで複雑な数式をイメージして「無理無理、そんなのは専門家が考えてくれ」と言いたくなるかもしれない。でもこれから挙げる3か条を知れば、きっとそんな人でも推薦システムをつくることができる。ベイズの定理なんて出てこないから安心してほしい。</p>

<h3 id="1-ユーザの評価ではなく-行動を見る:25cdf9391447727c734336a97ef76627">1. ユーザの評価ではなく、行動を見る</h3>

<p>Amazonで★5つとか付けている奴も案外その基準はテキトーなもんだ。自分の好みを正確に自分で理解している人なんていない。</p>

<p>だからレコメンデーションのためにユーザの趣味・嗜好を知りたければ、行動履歴を探るのが良い。友達のブラウザの閲覧履歴を覗けば、たぶん彼の性癖の1つくらいは読み取れる。そんな感じだ。</p>

<p>大切なのは、ユーザが<strong>どう思ったか</strong>ではなくて、<strong>何をしたか</strong>。行動が全てを物語っている。</p>

<h3 id="2-たくさんの行動履歴から傾向を見つけ出す:25cdf9391447727c734336a97ef76627">2. たくさんの行動履歴から傾向を見つけ出す</h3>

<p>いくら行動が全てを物語っているとはいえ、1人の行動を熱心にウォッチし続けても意味はない。そこから何となく嗜好を予想してアイテムをオススメするなんて、そりゃ友達にマンガを貸すときの話だよ。</p>

<p>インターネット上のアプリケーションでそんな推薦を行うのは賢いとは言えない。せっかく日々膨大なデータが生まれているんだから、もっとたくさんのユーザの行動履歴を手に入れて、そこから有益な傾向を見つけ出すのが良い。</p>

<p>Amazonの <strong>この商品を見たお客様はこれも見ています</strong> みたいなアイディアがまさにそれだ。あたかもコンピュータがデータ（履歴）を学習しているかのように推薦を行うから『機械学習』というわけだ。</p>

<p>行動履歴から傾向を見つけ出すときは<a href="https://mahout.apache.org/">Apache Mahout</a>が役に立つ。というか、こいつが全てをやってくれる。だから僕らは数式など気にせず、ただログを手に入れさえすればいい。それで十分。</p>

<p>とはいえブラックボックスのままツールを乱用するのは言語道断なので、ここはひとつ、みんな大好きなアニメを例にとって履歴から傾向を見つけ出す方法を説明しよう。</p>

<p>3人のアニメファンをイメージする。タカシと、ヒロキと、ケン。彼らがこれまでにBDを購入したアニメのタイトルはこんな感じ。</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">きんモザ</th>
<th align="center">ごちうさ</th>
<th align="center">Free!</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">タカシ</td>
<td align="center">◯</td>
<td align="center">◯</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">ヒロキ</td>
<td align="center">◯</td>
<td align="center"></td>
<td align="center"></td>
</tr>

<tr>
<td align="center">ケン</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">◯</td>
</tr>
</tbody>
</table>

<p>BDの購入は、そのアニメを好んでいるが故の行動と言える。さて、このBD購入履歴から傾向を見つけて、ヒロキに新しいアニメをオススメしてみよう。</p>

<p>まず、タカシが<strong>きんモザ</strong>と<strong>ごちうさ</strong>を共に買っていることから、この2つのアニメは共に好まれやすいという傾向が予想できる。そこで、<strong>きんモザ</strong>だけを買っているヒロキには<strong>ごちうさ</strong>をオススメしよう、という話になる。これがAmazonも使っている <strong>協調フィルタリング</strong> という考え方の基本だ。</p>

<p>今は3人だから微妙だけど、データが多ければ多いほどこのような <strong>共に好まれやすい傾向</strong> が推薦の根拠になる。以下のような状況では、もはやヒロキに<strong>ごちうさ</strong>を薦めない理由は無い。</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">きんモザ</th>
<th align="center">ごちうさ</th>
<th align="center">Free!</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">タカシ</td>
<td align="center">◯</td>
<td align="center">◯</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">ヒロキ</td>
<td align="center">◯</td>
<td align="center"></td>
<td align="center"></td>
</tr>

<tr>
<td align="center">タロウ</td>
<td align="center">◯</td>
<td align="center">◯</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">ミサ</td>
<td align="center">◯</td>
<td align="center">◯</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">シュン</td>
<td align="center">◯</td>
<td align="center">◯</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">ケン</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">◯</td>
</tr>
</tbody>
</table>

<p>これが行動履歴から傾向を判断し、推薦につなげていく基本的なアイディアになる。そして <strong>共に好まれやすい傾向</strong> をログから数値的に見つけ出してくれる機能を備えたのが、Mahoutというライブラリだ。</p>

<h3 id="3-高速な検索技術を活用する:25cdf9391447727c734336a97ef76627">3. 高速な検索技術を活用する</h3>

<p>今、<strong>きんモザ</strong>と<strong>ごちうさ</strong>が共に好まれやすいという傾向がわかった。それでは、ここでもし新しい登場人物・サトシが <strong>&ldquo;きんモザ　BD&rdquo;</strong> というキーワードでAmazonを検索していたら、Amazonのシステムはどう対応すべきだろう？</p>

<p>答えはシンプルだ。すかさず、<strong>ごちうさ</strong>のBDも <strong>こんな商品もいかがですか？</strong> と表示すればいい。</p>

<p>（ここまで書いてから確かめたら案の定そうなった）</p>

<p><img src="http://localhost:1313/images/jekyll/2014-09-01-amazon.png" alt="amazon" /></p>

<p>これが現実的なシーンでの推薦システムの動きになる。傾向に基づいた推薦は闇雲に広告を打つよりよっぽど賢いし、効果的だ。</p>

<p>ただし、「<strong>きんモザ</strong>で検索していたら、すかさず<strong>ごちうさ</strong>も表示する」という推薦処理は高速に行う必要がある。複雑なデータベースから<strong>きんモザ</strong>を見つけて、そこから更に<strong>ごちうさ</strong>と共に好まれやすいという傾向を引っ張ってきて、<strong>ごちうさ</strong>を見つけて・・・とやっていては遅すぎる。</p>

<p>【Now Loading&hellip;】とかActivity Indicatorでも画面に出すか？いや、ありえない。その間にサトシはcookpadへ移動してお昼ごはんのことを考え始めてしまう。</p>

<p>そんなときには<a href="http://lucene.apache.org/solr/">Apache Solr</a>を活用したい。こいつはインデックスを利用した高速な検索を実現する検索エンジンだ。これによって、<strong>きんモザ</strong>と<strong>ごちうさ</strong>が共に好まれやすいという傾向を予め明示的に記憶した検索システムが構築できる。すると、<strong>きんモザ</strong>が検索された時に即座に<strong>ごちうさ</strong>という関連ワードを引くことができて、高速に推薦ができるというわけだ。</p>

<p>　</p>

<p>そんなわけで</p>

<ul>
<li>ユーザの評価ではなく、行動を見る</li>
<li>たくさんの行動履歴から傾向を見つけ出す</li>
<li>高速な検索技術を活用する</li>
</ul>

<p>この3か条が、たとえ数式が理解できなくても、強力な推薦システムを構築・運用することができるエッセンスになる。</p>

<p>まずはユーザの行動履歴を集めて、そこからMahoutを使って傾向を見つけ出す。そして検索エンジンSolrにその傾向を反映する。（こういうデータ処理は一日一回、夜中にまとめてやるのがいい）</p>

<p>あとはシステムを走らせておけば、ユーザが検索を行う度に関連する情報が素早く引き出され、レコメンドされるという流れだ。おめでとう、それは立派な推薦システムだよ。</p>

<hr />

<p>さて、無料で公開されている電子書籍『実践 機械学習』の原著のほうを読みました。ここまでに書いたものは一応その要点。</p>

<p><a href="http://www.oreilly.co.jp/editors/archives/2014/08/practical-machine-learning.html">O&rsquo;Reilly Village／オラの村 - 電子書籍『実践 機械学習』の無料ダウンロードが可能に！</a></p>

<blockquote>
<p>著者は『Mahoutイン・アクション』の著作でもお馴染みのTed DunningとEllen Friedman。Apache Mahoutプロジェクトでプロジェクトマネジメント委員やコミッタとして活躍しながら、MapR社でチーフアプリケーションアーキテクトやコンサルタントを務めている両氏が、機械学習の初学者のために書き下ろしたの一冊です。50ページほどの手軽なボリュームながら、レコメンデーションを洗練させるための重要なエッセンスが詰まっています。</p>
</blockquote>

<p>とのこと。</p>

<p>なお原著は以下から。</p>

<p><a href="https://www.mapr.com/practical-machine-learning">Practical Machine Learning | MapR</a></p>

<p>『実践』だから回帰とかニューラルネットとか、機械学習の基礎を学んだ人のための本・・・ではない。誰でもすぐにパワフルな推薦システムが作れるよ、という意味で『実践』。</p>

<p>確かにもっと複雑で凄そうな推薦システムもたくさん提案されているけど、本当にそれが『実践』的なのかという点は重要。Amazonの推薦にも、毎回同じ商品をオススメしてきてしつこいみたいな欠点はある。でも、なんだかんだでそれなりに上手く動いてるじゃないか。それでいいんだよ、それで。</p>

<p>『実践 機械学習』では、上に書いた3か条（かなり脚色してるけど大筋は外していないはず）を説明した上で、仮想の音楽視聴サービスを題材にして実際的な推薦システムの作り方を解説している。このとき、Map Reduce云々とかPython使うとか、かなり細部の構成や手段まで言及している印象。</p>

<p>さらに最後には、レコメンデーションのクオリティを上げるためのTipsも紹介している。</p>

<p>たとえば、もっと多様な行動履歴（動画見たり、商品買ったり、音楽聞いたりetc）を考慮して嗜好を判断してみましょう、とか。</p>

<p>50ページほどなので、読んですぐに推薦システムを作るのはさすがに難しいかもしれない。でも、次に学ぶべきことの指針になるし、実際にアプリケーションを作るときに考慮すべきこともクリアになる。</p>

<p>機械学習に興味を持った人が集合知プログラミングの前に読むとちょうど良さそうな、そんな感じ。</p>

<div class="booklink-box" style="text-align:left;padding-bottom:20px;font-size:small;/zoom: 1;overflow: hidden;"><div class="booklink-image" style="float:left;margin:0 15px 10px 0;"><a href="http://www.amazon.co.jp/exec/obidos/asin/4873113644/takuti-22/" name="booklink" rel="nofollow" target="_blank"><img src="http://ecx.images-amazon.com/images/I/51FgSThMzVL._SL160_.jpg" style="border: none;" /></a></div><div class="booklink-info" style="line-height:120%;/zoom: 1;overflow: hidden;"><div class="booklink-name" style="margin-bottom:10px;line-height:120%"><a href="http://www.amazon.co.jp/exec/obidos/asin/4873113644/takuti-22/" rel="nofollow" name="booklink" target="_blank">集合知プログラミング</a><div class="booklink-powered-date" style="font-size:8pt;margin-top:5px;font-family:verdana;line-height:120%">posted with <a href="http://yomereba.com" rel="nofollow" target="_blank">ヨメレバ</a></div></div><div class="booklink-detail" style="margin-bottom:5px;">Toby Segaran オライリージャパン 2008-07-25    </div><div class="booklink-link2" style="margin-top:10px;"><div class="shoplinkamazon" style="display:inline;margin-right:5px"><a href="http://www.amazon.co.jp/exec/obidos/asin/4873113644/takuti-22/" rel="nofollow" target="_blank" title="アマゾン" >Amazon</a></div><div class="shoplinkkindle" style="display:inline;margin-right:5px"><a href="http://www.amazon.co.jp/gp/search?keywords=%8FW%8D%87%92m%83v%83%8D%83O%83%89%83~%83%93%83O&__mk_ja_JP=%83J%83%5E%83J%83i&url=node%3D2275256051&tag=takuti-22" rel="nofollow" target="_blank" >Kindle</a></div><div class="shoplinkrakuten" style="display:inline;margin-right:5px"><a href="http://hb.afl.rakuten.co.jp/hgc/10952997.eae88ca3.10952998.38cdd415/?pc=http%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F5805670%2F%3Fscid%3Daf_ich_link_urltxt%26m%3Dhttp%3A%2F%2Fm.rakuten.co.jp%2Fev%2Fbook%2F" rel="nofollow" target="_blank" title="楽天ブックス" >楽天ブックス</a></div>                                </div></div><div class="booklink-footer" style="clear: left"></div></div>

<p>無料にしてはなかなか濃い内容だっと思う。あと、原著で読むと読解力が足りなくて自然と細部が削ぎ落とされるので、内容を整理しやすいですね。（決して良いことではない）</p>

<p>※3か条の話は原著を一読しただけの理解で書いたので、間違いがあるかもしれません。特にMahoutやSolrは使ったことがないので、何かあればご指摘下さい。</p>

<p>僕もせっかく読んだので何か実際に推薦システム作ってみなきゃですね。</p>

    <br /><a href="https://twitter.com/share" class="twitter-share-button" data-via="takuti">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </div>
  <div id="disqus_thread"></div>
    <script type="text/javascript">
         
        var disqus_shortname = 'takuti'; 

         
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>
		</div>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<script src="http://localhost:1313/google-code-prettify/prettify.js"></script>
		<script>prettyPrint();</script>

		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [ ['$','$'], ["\\(","\\)"] ],
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				processEscapes: true
			}
		});
		</script>
		<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-28919399-2', 'auto');
			ga('send', 'pageview');

		</script>
	<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
