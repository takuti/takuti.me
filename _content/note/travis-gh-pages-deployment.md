---
date: 2017-06-26
lang: en
recommendations: [/note/move-to-gh-pages/, /note/hugo-markdown-and-mathjax/, /note/hugo-kramdown-and-katex/]
title: Deploying Static Site to GitHub Pages via Travis CI
---

As I repeatedly mentioned in this blog, [takuti.me](https://takuti.me) is currently generated by [Hugo](https://gohugo.io/):

- [Migrate to Hugo from Jekyll: Another Solution for the MathJax+Markdown Issue](/note/hugo-markdown-and-mathjax/)
- [Moving to GitHub Pages](/note/move-to-gh-pages/)
- [Hugo meets kramdown + KaTeX #gohugo](/note/hugo-kramdown-and-katex/)

### Manual deployment

Until quite recently, my deployment workflow was not clever; I manually followed the steps as:

1. Write an article under `takuti.me/_content` directory
2. Hit `rake` command and generate my site under the `public/` directory
3. Commit & push `takuti.me/*` to [repository (source)](https://github.com/takuti/takuti.me), except for `public/`
4. Commit & push `takuti.me/public/*` to [repository (GitHub Pages)](https://github.com/takuti/takuti.github.io)

It actually works, but we can automate the workflow more aggressively...it's 2017!

### Utilizing `deploy:` feature on Travis CI

So, eventually deployment becomes easier thanks to the following guide:

- [GitHub Pages Deployment - Travis CI](https://docs.travis-ci.com/user/deployment/pages/)

My current `.travis.yml` looks like:

```yml
language: c
os: osx

before_script:
  - npm install -g gulp
  - npm install
  - brew update && brew install hugo

script:
  - rake

branches:
  only:
    - master

notifications:
  email: false

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: public
  github_token: $GITHUB_TOKEN # Set in travis-ci.org dashboard
  on:
    branch: master
  repo: takuti/takuti.github.io
  target_branch: master
  fqdn: takuti.me
```

Once you have set your `$GITHUB_TOKEN` to environment variables in [travis-ci.org](https://travis-ci.org/), CI on [source repository](https://github.com/takuti/takuti.me) automatically generates your site and pushes it to [GitHub Pages repository](https://github.com/takuti/takuti.github.io); now what we have to do is:

1. Write an article under `takuti.me/_content` directory
2. Commit & push `takuti.me/*` to [repository (source)](https://github.com/takuti/takuti.me), except for `public/`

Neat, huh?

In case that you are using custome domain on GitHub Pages like me, setting `fqdn:` as `fqdn: takuti.me` enables Travis CI to automatically create the `CNAME` file under `xxx.github.io` repository.

### Next

Unfortunately, the CI-based deployment still has problems.

First, **Deployment Bot** removes all of your commit logs in `xxx.github.io` repository; it forcibly pushes to the repository:

![travis-deploy-bot](/images/hugo-site/travis-deploy-bot.png)

In addition, since installation such as `npm install` and `brew install` is necessaly for every time CI is launched, deployment usually takes more than 5 minutes.

In fact, these are minor problems from a practical point of view, but I personally believe that deploying static site can be more efficient and technologically stimulating by different approach e.g., using Docker containers. So, I continuouslly try to update how to organize [takuti.me](https://takuti.me).