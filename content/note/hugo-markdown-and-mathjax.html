---
layout: post
title: "Migrate to Hugo from Jekyll: Another Solution for the MathJax+Markdown Issue"
lang: en
date: 2015-10-19
---

<h3 id="migrate-to-hugo-from-jekyll">Migrate to Hugo from Jekyll</h3>

<p>I had used <a href="https://github.com/jekyll/jekyll">Jekyll</a> to generate this site for 1+ years. However, recently generating site took more than 10 seconds due to increasing site contents; this was really stressful when I like to check the generated site continuously (e.g. style updating).</p>

<p>Hence, from this article, I have migrated to <a href="https://github.com/spf13/hugo">Hugo</a>, and this fast static site generator can build my site less than 1 second! Migrating to Hugo from Jekyll is not so difficult because there are many useful information on the Internet such as:</p>

<ul>
  <li><a href="https://gohugo.io/tutorials/migrate-from-jekyll/">Migrating to Hugo From Octopress</a></li>
  <li><a href="http://nathanleclaire.com/blog/2014/12/22/migrating-to-hugo-from-octopress/">Migrate to Hugo from Jekyll</a></li>
  <li><a href="https://github.com/spf13/spf13.com">spf13/spf13.com</a></li>
</ul>

<p>In particular, <a href="https://github.com/spf13/spf13.com">spf13/spf13.com</a>, a repository of Hugo creator’s website, is practically useful to understand what we have to do.</p>

<h3 id="mathjaxmarkdwon-issue">MathJax+Markdwon issue</h3>

<p>In the TeX syntax, we frequently use <code>_</code> (underline) to render subscripts. However, at the same time, underline also indicates <em>italic</em> font in Markdwon. This situation raises a mis-converting issue; when Markdown is first parsed, MathJax might not understand TeX formulas correctly.</p>

<p>One solution for the issue is introduced in Hugo official support page: <a href="http://gohugo.io/tutorials/mathjax/#issues-with-markdown:d97e838dbdddd8f0d2665b07f195e51f">MathJax Support - Issues with Markdown</a></p>

<p>OK, we can easily fix the issue, but I don’t like this solution. Putting backticks (<code>`</code>) at the head/tail of every TeX code is so annoying…</p>

<p>On that point, Jekyll is great; in Jekyll configuration, we can use <a href="http://kramdown.gettalong.org/">kramdown</a> (pure-Ruby Markdown convertor) as a Markdown parser, and it can correctly handle MathJax+Markdown mixed files.</p>

<h3 id="using-kramdown-as-a-hugo-markdown-convertor">Using kramdown as a Hugo Markdown convertor</h3>

<p>Here, I have another solution. It just to use kramdown as a Hugo Markdown convertor. Usually, Hugo requires us to put articles in <em>content/</em> directory, and it automatically converts them to .html files. However, we now create a intermediate directory like <em>_content/</em>.</p>

<p>First, I create Rakefile and define a task as:</p>

<pre class="prettyprint lang-ruby">
require "kramdown"

namespace :converter do
  task :content do
    Dir::glob("_content/*").each do |src|
      # destination path will be "content/{filename}.html"
      dst_path = src[1..-1].sub(/(.*)\.md/, '\1.html')
			
      open(dst_path, "w") do |dst|
        content = open(src) { |f| f.read }
				
        # keep front matter
        content = content.sub(/(---.*---\n)/m, "")
				
        content = embedding_tweet(content)

        # write with concatenating front matter
        dst.write($1 + Kramdown::Document.new(content).to_html)
      end
    end
  end
end
</pre>

<p>As I mentioned before, kramdown can correctly handle MathJax+Markdown mixed files in default setting, so it works.</p>

<p>Next, you just need to run converter before running Hugo server: <code>rake converter:content</code></p>

<p>After the rake command, we do not have to think about Hugo Markdown converter. Even if there are some mixed articles, <code>hugo server</code> will generate your site correctly based on html files obtained by the rake command.</p>

<p>Note that we can use this technique for the other preprocessing such as sass compiling. For more detail, you can see <a href="https://github.com/takuti/takuti.me/blob/master/Rakefile">my actual Rakefile</a>.</p>

<h3 id="conclusion">Conclusion</h3>

<p>I have shown you another solution for the MathJax+Markdown issue. However, since my technique requires to run preprocessing, we cannot take advantage of fast incremental building from Hugo.</p>

<p>If we really want to fix the issue, we have to tackle Hugo original Markdown parser and develop Go implementation of kramdown.</p>
